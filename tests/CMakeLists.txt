#
# @file tests/CMakeLists.txt
# @brief TinaXlsx æµ‹è¯•é…ç½® - ä½¿ç”¨ TestUtils.cmake å·¥å…·å‡½æ•°
#

message(STATUS "Configuring TinaXlsx Tests...")

# ç¡®ä¿åŒ…å«æµ‹è¯•å·¥å…·å‡½æ•°
include(${CMAKE_SOURCE_DIR}/cmake/TestUtils.cmake)

# å¯ç”¨æµ‹è¯•
enable_testing()

# =============================================================================
# åŠŸèƒ½æµ‹è¯• (Functional Tests)
# =============================================================================

# å†…å­˜ä¼˜å…ˆæ¶æ„APIæµ‹è¯•
add_unit_test(MemoryFirstAPI 
    functional/test_memory_first_api.cpp
)


add_unit_test(Variant
    unit/test_variant.cpp
)

# ğŸš€ é«˜æ€§èƒ½æ—¥å¿—åº“æµ‹è¯•
add_unit_test(HighPerformanceLogger
    unit/test_high_performance_logger.cpp
)


# =============================================================================
# æ€§èƒ½æµ‹è¯• (Performance Tests)
# =============================================================================

# æè‡´æ€§èƒ½æµ‹è¯•
add_performance_test(ExtremePerformance 
    performance/test_extreme_performance.cpp
)


# =============================================================================
# é›†æˆæµ‹è¯• (Integration Tests)
# =============================================================================

# å®Œæ•´å·¥ä½œæµé›†æˆæµ‹è¯•
add_unit_test(WorkflowIntegration
    integration/test_workflow_integration.cpp
)

# =============================================================================
# è°ƒè¯•æµ‹è¯• (Debug Tests)
# =============================================================================

# åŒ…å«è°ƒè¯•æµ‹è¯•å­ç›®å½•
add_subdirectory(debug)

# =============================================================================
# æ‰¹é‡è¿è¡Œç›®æ ‡
# =============================================================================

# åˆ›å»ºæ‰¹é‡æµ‹è¯•ç›®æ ‡
create_batch_test_targets()

# =============================================================================
# è‡ªå®šä¹‰æµ‹è¯•ç›®æ ‡
# =============================================================================

# æ€§èƒ½åŸºå‡†æµ‹è¯• - å•ç‹¬ç›®æ ‡
add_custom_target(RunPerformanceBenchmark
    COMMAND echo "ğŸš€ è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•..."
    COMMAND ExtremePerformancePerformanceTests
    COMMAND TwoMsChallengePerformanceTests
    COMMAND SIMDPerformancePerformanceTests
    DEPENDS 
        ExtremePerformancePerformanceTests 
        TwoMsChallengePerformanceTests
        SIMDPerformancePerformanceTests
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/tests/performance
    COMMENT "è¿è¡Œå®Œæ•´æ€§èƒ½åŸºå‡†æµ‹è¯•å¥—ä»¶"
)

# éªŒè¯æ ¸å¿ƒåŠŸèƒ½ - å¿«é€ŸéªŒè¯
add_custom_target(ValidateCore
    COMMAND echo "âœ… éªŒè¯æ ¸å¿ƒåŠŸèƒ½..."
    COMMAND MemoryFirstAPITests
    COMMAND BatchSIMDProcessorTests
    COMMAND ZeroCopySerializerTests
    DEPENDS 
        MemoryFirstAPITests
        BatchSIMDProcessorTests  
        ZeroCopySerializerTests
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "éªŒè¯æ ¸å¿ƒç»„ä»¶åŠŸèƒ½"
)

# 2msæŒ‘æˆ˜ä¸“é¡¹æµ‹è¯•
add_custom_target(Challenge2Ms
    COMMAND echo "ğŸ¯ 2msæŒ‘æˆ˜å¼€å§‹..."
    COMMAND TwoMsChallengePerformanceTests --gtest_filter="*TwoMillisecond*"
    DEPENDS TwoMsChallengePerformanceTests
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/tests/performance
    COMMENT "ğŸš€ 2msæ€§èƒ½æŒ‘æˆ˜æµ‹è¯•"
)

# =============================================================================
# æµ‹è¯•é…ç½®æ‘˜è¦
# =============================================================================

# æ‰“å°æµ‹è¯•é…ç½®æ‘˜è¦
print_test_summary()

message(STATUS "")
message(STATUS "ğŸš€ TinaXlsx æµ‹è¯•é…ç½®å®Œæˆï¼")
message(STATUS "")
message(STATUS "å¯ç”¨çš„æµ‹è¯•ç›®æ ‡:")
message(STATUS "  åŸºç¡€ç›®æ ‡:")
message(STATUS "    - make test              : è¿è¡Œæ‰€æœ‰CTestæµ‹è¯•")
message(STATUS "    - make RunAllUnitTests   : è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•")
message(STATUS "    - make RunAllPerformanceTests : è¿è¡Œæ‰€æœ‰æ€§èƒ½æµ‹è¯•")
message(STATUS "    - make RunQuickTests     : è¿è¡Œå¿«é€Ÿæµ‹è¯•")
message(STATUS "")
message(STATUS "  ä¸“é¡¹ç›®æ ‡:")
message(STATUS "    - make ValidateCore      : éªŒè¯æ ¸å¿ƒåŠŸèƒ½")
message(STATUS "    - make Challenge2Ms      : ğŸ¯ 2msæŒ‘æˆ˜")
message(STATUS "    - make RunPerformanceBenchmark : ğŸš€ æ€§èƒ½åŸºå‡†æµ‹è¯•")
message(STATUS "")
message(STATUS "  å•ç‹¬æµ‹è¯•:")
message(STATUS "    - make RunMemoryFirstAPITests : APIåŠŸèƒ½æµ‹è¯•")
message(STATUS "    - make RunExtremePerformancePerformanceTests : æè‡´æ€§èƒ½æµ‹è¯•")
message(STATUS "")
message(STATUS "==========================================") 
